# PHP SDK IML API
![IML](https://iml.ru/logo/logo)

Обертка для http://api.iml.ru на PHP.


## Requirements

* PHP >= 7.1

#Dependencies
* [Guzzle, PHP HTTP client](https://github.com/guzzle/guzzle)

## Install

Via Composer:

```bash
$ composer require babakin/sdk-api-iml
```


## Basic usage of `SDK IML` client

```php
<?php

// This file is generated by Composer
require_once __DIR__ . '/vendor/autoload.php';


$order = new \IMLSdk\Order('24КО');
```
Активируем тестовый режим при необходимости:
```php
$order->testMode();
```
Добавляем данные доставки. Данные для регионов `$order->regionCodes($from,$to)` берем из [справочника](http://api.iml.ru/region):
```php
$order->regionCodes('МОСКВА','АНАПА');
$order->setContacts('84893087496','megaivanych@gmail.com','Иваныч');
$order->setAddressDelivery('Ленина 1, кв34');
```

Для расчета стоимости `$client->calculate()` и создания заказа `$client->createOrder()` необходимо создать грузовые места и товарные 
вложения этих грузовых мест (передача пустого грузового места приведет к ошибке).
Создаем товарное вложение с параметрами: Название, Вес, Стоимость и Наложенная стоимость (не обязательный):
```php
$item = new \IMLSdk\Item('Семена Цветной капусты СКАЙВОКЕР',2.3,1000,1000);
```
Можно добавить любое свойство обьекта `Item` через сеттер, имя свойства через CamelCase. 

Пример:  
``` php 
$item->setDiscount(10); 
$item->setItemNote('Заметочка') 
```

Количество товарных однотипных вложений:
```php
$item->setItemQuantity(3);
```
Грузовое место для товарных вложений:
```php
$pack = new \IMLSdk\Package($item);
```
Добавить товарное вложение, установить габариты грузового места:
```php
$pack->setItem($item2);
$pack->setPackageDimensions(2000,2000,2000);
```
## Расчет стоимости и создание заказа
Добавляем грузовые места к заказу:
```php
$order->setPackage($pack); //$pack2,$pack3...
```
Создаем клиент и добавляем данные заказа:
```php
$client = \IMLSdk\IMLClient::instance('УНК','Пароль');
$client->setOrder($order);
```
#
Считаем и создаем заказ в IML:
```php
$responsePrice = $client->calculate();
$responseOrder = $client->createOrder();
```
#Доставка самовывозом до пункта выдачи заказов (ПВЗ)
В sdk доступны четыре услуги (варианта доставки) С24, С24КО, 24, 24КО из справочника [услуг](http://api.iml.ru/list/service) (требуется авторизация).
Услуги С24,С24КО подразумевают доставку отправления на ПВЗ. 
Создание заказа на доставку на ПВЗ:
```php
    /**
     * @return array|Point[]
     * @throws ExceptionIMLClient
     */
//Получаем все возможные ПВЗ
$client->getDeliveryPoints();

//Получаем определенную ПВЗ по коду из справочника 
$point = $client->getPointByCode('АНАПА_ПС3');

```
***Внимание!! Услуги передаются кириллицей!***

Далее просто указываем ПВЗ, в который необходимо доставить отправление:
```php
$order = new \IMLSdk\Order('С24КО')//С24;
$order->setPointTo($point);
```
При указании ПВЗ при самовывозе регион получения указывать не обязательно:
```php
$order->regionFrom('МОСКВА');
//или
$order->regionCodes('МОСКВА');
```

И далее:

```php
$client->setOrder($order);
$responsePrice = $client->calculate();
$responseOrder = $client->createOrder();
```

Справочник [ПВЗ](http://api.iml.ru/list/sd).

####



## License

is licensed under the MIT License

